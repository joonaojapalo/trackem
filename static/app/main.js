// Generated by CoffeeScript 1.10.0
(function() {
  define(["handlebars", "radio", "app/state", "app/views/app-layout", "app/locales/locale"], function(Handlebars, Radio, state, AppLayoutView, locale) {
    var $, AppRouter, Backbone, Marionette, appLayout, appRouter, navChannel, userChannel;
    $ = require("jquery");
    Backbone = require("backbone");
    Marionette = require("marionette");
    Marionette.Renderer.render = function(template, data) {
      return Handlebars.compile(template)(data);
    };
    Handlebars.registerHelper("_", function(keyword, options) {
      var ref;
      return new Handlebars.SafeString((ref = locale[state.get("locale")][keyword]) != null ? ref : keyword);
    });
    navChannel = Radio.channel("navigation");
    userChannel = Radio.channel("user");
    appLayout = new AppLayoutView;
    AppRouter = Backbone.Router.extend({
      routes: {
        "": "dashboard",
        "maps": "maps",
        "races": "races",
        "groups": "groups",
        "user": "user"
      },
      requireAndShow: function(layoutName) {
        return require(["app/views/" + layoutName + "/layout"], function(LayoutView) {
          var layout;
          console.log("got " + layoutName + " layout. rendering..");
          layout = new LayoutView;
          layout.on("show", function() {
            return navChannel.trigger(layoutName);
          });
          return appLayout.contentRegion.show(layout);
        });
      },
      dashboard: function() {
        return this.requireAndShow("dashboard");
      },
      user: function() {
        return this.requireAndShow("user");
      },
      maps: function() {
        return this.requireAndShow("maps");
      },
      races: function() {
        return this.requireAndShow("races");
      },
      groups: function() {
        return this.requireAndShow("groups");
      }
    });
    appRouter = new AppRouter();
    navChannel.on("maps", console.log.bind(console, "navChannel:maps"));
    return ($.when((state.get("user")).fetch())).then(function() {
      appLayout.on("render", function() {
        return Backbone.history.start();
      });
      return appLayout.render();
    });
  });

}).call(this);
